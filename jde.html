<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Expedition Calculator</title>
</head>
<body>
    <div style="text-align: center; margin-top: 50px;">
        <button id="calculate-button">Рассчитать доставку</button>
        <div id="results" style="margin-top: 20px;"></div>
    </div>
</body>
<script>
    class RailwayExpeditionCalculator {
        constructor(apiUrl) {
            this.apiUrl = apiUrl;

            // Данные для отправки
            this.data = {
                dollar_rate: 100,
                from: 'Москва', // всегда этот город
                to: 'Москва', // всегда этот город
                lat_from: 55.621761, // всегда эти значение
                lon_from: 37.786385, // всегда эти значение
                lat_to: 43.115542,
                lon_to: 131.885494,
                total_volume: 1,
                total_weight: 100,
                count: 1,
            };
        }

        // Формирование строки запроса
        buildQueryString() {
            return new URLSearchParams(this.data).toString();
        }

        // Отправка данных на внешний API
        async calculateDelivery() {
            try {
                const queryString = this.buildQueryString();
                const response = await fetch(`${this.apiUrl}?${queryString}`, {
                    method: 'GET',
                });

                if (!response.ok) throw new Error(`Ошибка API: ${response.status}`);

                const result = await response.json();
                this.showResults(result);
            } catch (error) {
                console.error('Ошибка при расчете доставки:', error.message);
            }
        }

        // Отображение результатов
        showResults(results) {
            const resultContainer = document.getElementById('results');
            resultContainer.innerHTML = `
                <p>Стоимость авто (регуляр): ${results.cost_price?.auto_regular || 'н/д'}</p>
                <p>Общая стоимость авто (регуляр): ${results.sum_cost_price?.auto_regular || 'н/д'}</p>
            `;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const calculator = new RailwayExpeditionCalculator('https://api-calc.wisetao.com:4343/api/calculate-railway-expedition-delivery');

        // Обработчик кнопки
        document.getElementById('calculate-button').addEventListener('click', () => {
            calculator.calculateDelivery();
        });
    });
</script>
</html>